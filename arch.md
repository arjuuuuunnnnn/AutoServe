┌─────────────────────────────────────────────────────────────────────────────┐
│                            External Traffic                                 │
│                          (Users/Applications)                               │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       Application Load Balancer                             │
│                          Nginx (Port 80/443)                                │
│                       container: autoserve-nginx                            │
│                                                                             │
│       ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │
│       │    my-app-0     │ │    my-app-1     │ │    my-app-N     │           │
│       │(172.20.0.x:8080)│ │(172.20.0.x:8080)│ │(172.20.0.x:8080)│           │
│       └─────────────────┘ └─────────────────┘ └─────────────────┘           │
│                       (Internal Docker Network IPs)                         │
│                     (Dynamic Upstream Configuration)                        │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Controller Load Balancer                             │
│                            Nginx (Port 8000)                                │
│                    container: autoserve-controller-lb                       │
│                                                                             │
│        Routes API calls to current leader controller with failover          │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       AutoServe Controller Cluster                          │
│                       (3-Node with Leader Election)                         │
│                                                                             │
│        ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│        │ Controller-1    │ │ Controller-2    │ │ Controller-3    │          │
│        │   (Leader)*     │ │  (Follower)     │ │  (Follower)     │          │
│        │   Port 8001     │ │   Port 8002     │ │   Port 8003     │          │
│        └─────────────────┘ └─────────────────┘ └─────────────────┘          │
│                                                                             │
│        Each Controller Node Contains:                                       │
│        ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│        │   API Server    │ │  App Manager    │ │   Auto Scaler   │          │
│        │   (FastAPI)     │ │ (Docker SDK)    │ │ (Multi-Metric)  │          │
│        └─────────────────┘ └─────────────────┘ └─────────────────┘          │
│                                                                             │
│        ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│        │ Health Checker  │ │ Nginx Manager   │ │   Clustering    │          │
│        │    (HTTP)       │ │ (Config Gen)    │ │ (Leader Elect)  │          │
│        └─────────────────┘ └─────────────────┘ └─────────────────┘          │
│                                                                             │
│  Shared Volumes: /var/run/docker.sock, /nginx-config, /app/logs             │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             PostgreSQL HA Cluster                           │
│                                                                             │
│        ┌─────────────────┐                        ┌─────────────────┐       │
│        │    Primary      │◄──── Streaming ───────►│     Replica     │       │
│        │   (Read/Write)  │      Replication       │   (Read Only)   │       │
│        │   Port 5432     │                        │   Port 5433     │       │
│        └─────────────────┘                        └─────────────────┘       │
│                                                                             │
│  Used for: App specs, instances, events, metrics, cluster coordination      │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Docker Engine                                  │
│                            (Container Runtime)                              │
│                                                                             │
│        ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│        │    my-app-0     │ │    my-app-1     │ │    my-app-2     │          │
│        │   (Container)   │ │   (Container)   │ │   (Container)   │          │
│        │ 172.20.0.x:8080 │ │ 172.20.0.x:8080 │ │ 172.20.0.x:8080 │          │
│        └─────────────────┘ └─────────────────┘ └─────────────────┘          │
│                                                                             │
│  Network: autoserve (bridge)                                                │
│  Managed by: Controller cluster via Docker socket (/var/run/docker.sock)    │
└─────────────────────────────────────────────────────────────────────────────┘
